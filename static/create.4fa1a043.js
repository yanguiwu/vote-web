var Q=Object.defineProperty,X=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var N=(e,u,o)=>u in e?Q(e,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[u]=o,S=(e,u)=>{for(var o in u||(u={}))K.call(u,o)&&N(e,o,u[o]);if(U)for(var o of U(u))L.call(u,o)&&N(e,o,u[o]);return e},z=(e,u)=>X(e,Z(u));var j=(e,u)=>{var o={};for(var n in e)K.call(e,n)&&u.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&U)for(var n of U(e))u.indexOf(n)<0&&L.call(e,n)&&(o[n]=e[n]);return o};import{_ as O,b as x,c as ee,a as ue}from"./index.b1bc12a8.js";import{h as Y,r as C,t as ae,P as H,o as q,w as le,ak as te,al as oe,l as h,y as P,z as w,g as ne,k as y,q as W,B as J,C as l,D as t,U as I,O as p}from"./element-plus.b05a9d59.js";import{e as se,c as re,q as ie}from"./index.5c36cd16.js";import{i as de}from"./util.43d19722.js";import{v as me}from"./formExtend.e1564a97.js";const pe=Y({props:{value:{type:String,default:""},type:{type:String,default:"Thread"},contentsCss:{type:String,default:""},fontSizeDefaultLabel:{type:String,default:""},inline:{type:[Boolean],default:!1},disabled:{type:Boolean,default:!1}},emits:["change","blur","focus"],setup(e,u){let o=null,n=null,D=C((Math.random()*1e4).toFixed().toString()),d=C(!0),{value:m,type:r,contentsCss:s,fontSizeDefaultLabel:B,inline:V,disabled:v}=ae(e);console.log("value111",m.value);const F=()=>{n=WebUploader.create({swf:CKEDITOR.getUrl("plugins/uploadpictures/webuploader/Uploader.swf"),server:window.CKEDITOR_UPLOAD_SERVER,compress:{width:1200,height:8e3,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0},resize:!1,fileNumLimit:10,threads:1,fileSingleSizeLimit:1024*1024*1024,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png,ico",mimeTypes:"image/*"}}),n.on("uploadBeforeSend",function(a,f,_){$.ajaxSettings.async=!1;let c={name:a.file.name};console.log("sendData",c),$.ajax({url:`${window.VUE_APP_BASE_API}/upload/public/init`,data:JSON.stringify(c),type:"post",contentType:!1,dataType:"json",processData:!1,success:function(b){b.body.paramNames.map(function(g){f[g]=b.body.formData[g]}),b.body.ignoreParams&&b.body.ignoreParams.length>0&&b.body.ignoreParams.map(function(g){delete f[g]})}}),$.ajaxSettings.async=!0}),n.on("uploadSuccess",(a,f)=>{let _={size:a.size,contentType:a.type,name:a.name};f&&f.url&&(_.path=f.url),f&&f.key&&(_.path=f.key),$.ajax({url:`${window.VUE_APP_BASE_API}/upload/public/finish/other`,data:JSON.stringify(_),type:"post",contentType:!1,dataType:"json",processData:!1,success:c=>{CKEDITOR.instances[this.cid].insertHtml(`<img src="${c.body}" alt="" />`)},error:function(){}})})},E=a=>{const f=ne();console.log("internalInstance",f),console.log("internalInstance",document),CKEDITOR.instances[a].on("instanceReady",function(_){o.setData(m.value),this.document.on("paste",function(c){let{items:b}=c.data.$.clipboardData;for(let g=0;g<b.length;++g){let T=b[g];if(T.kind=="file"&&T.type=="image/png"){let R=T.getAsFile();return R?(n.addFiles(R),n.upload(),!1):!0}}})})},A=()=>{window.CKEDITOR_UPLOAD_SERVER&&F()},i=()=>{let a={toolbar:r.value,contentsCss:s.value,fontSize_defaultLabel:B.value};console.log("CKEDITOR2",V),V.value?(CKEDITOR.disableAutoInline=!1,o=CKEDITOR.inline(D.value,a)):o=CKEDITOR.replace(D.value,a),d.value=!1,o.on("change",function(){u.emit("change",o.getData())}),o.on("blur",function(){u.emit("blur"),u.emit("change",o.getData())}),o.on("focus",function(){u.emit("focus")}),A(),E(D.value)};return H(()=>{i()}),q(()=>{o.destroy()}),le(m,a=>{a!==o.getData()&&CKEDITOR.instances[D.value]&&(CKEDITOR.instances[D.value].destroy(),d.value=!0,setTimeout(()=>{i()},300))}),{cid:D,ckeditor:o,uploader:n,loading:d}}}),fe={class:"editor"},De=["id","disabled"];function Fe(e,u,o,n,D,d){const m=te("loading");return oe((h(),P("div",fe,[w("textarea",{id:e.cid,disabled:e.disabled},null,8,De)],512)),[[m,e.loading]])}var ye=O(pe,[["render",Fe],["__scopeId","data-v-506257f9"]]);const be=Y({components:{editor:ye},props:{modelValue:{type:String,default:""},type:{type:String,default:"Thread"},contentsCss:{type:String,default:""},fontSizeDefaultLabel:{type:String,default:""},inline:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["blur","focus","change","update:modelValue"],setup(e,u){const o=C(!1),n=()=>{window.$.get(`${{}.VUE_APP_BASE_API}/upload/public/server`,r=>{r.body&&(window.CKEDITOR_UPLOAD_SERVER=r.body,o.value=!0)})},D=()=>{u.emit("blur")},d=()=>{u.emit("focus")},m=r=>{u.emit("update:modelValue",r),r&&u.emit("change",r)};return H(()=>{window.CKEDITOR_UPLOAD_SERVER="http://106.55.147.176/vote-api/sys-file/img-upload ",setTimeout(()=>{window.CKEDITOR_UPLOAD_SERVER?o.value=!0:n()},300)}),q(()=>{window.CKEDITOR_UPLOAD_SERVER="",window.CKEDITOR_UPLOAD_INIT="",window.CKEDITOR_UPLOAD_FINISH=""}),{initEditor:o,initUploadServer:n,onBlur:D,onFocus:d,onChange:m}}});function ge(e,u,o,n,D,d){const m=y("editor");return h(),P("div",null,[e.initEditor?(h(),W(m,{key:0,value:e.modelValue,type:e.type,disabled:e.disabled,"contents-css":e.contentsCss,"font-size-default-label":e.fontSizeDefaultLabel,inline:e.inline,onBlur:e.onBlur,onFocus:e.onFocus,onChange:e.onChange},null,8,["value","type","disabled","contents-css","font-size-default-label","inline","onBlur","onFocus","onChange"])):J("",!0)])}var Ve=O(be,[["render",ge]]);const Ee=Y({components:{CkEditor:Ve},props:{listData:{type:Array,default:()=>[]}},setup(){const e=C(null),{getStatus:u}=x(),o=ee(),n=ue(),D={"x-auth-token":u.ACCESS_TOKEN},d=C([]),m="http://106.55.147.176/vote-api/sys-file/img-upload ",r=C({isAnonymou:1,isExamine:1,isPayOrder:1,isRandomVote:1}),s={title:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"},{max:40,message:"\u957F\u5EA6\u4E0D\u8D85\u8FC740",trigger:"blur"}],rollTitle:[{max:120,message:"\u957F\u5EA6\u4E0D\u8D85\u8FC7120",trigger:"blur"}],sta:[{required:!0,message:"\u8BF7\u9009\u62E9\u65F6\u95F4",trigger:"blur"}],startTime:[{required:!0,message:"\u8BF7\u9009\u62E9\u65F6\u95F4",trigger:"blur"}],endTime:[{required:!0,message:"\u8BF7\u9009\u62E9\u65F6\u95F4",trigger:"blur"}],startVoteTime:[{required:!0,message:"\u8BF7\u9009\u62E9\u65F6\u95F4",trigger:"blur"}],endVoteTime:[{required:!0,message:"\u8BF7\u9009\u62E9\u65F6\u95F4",trigger:"blur"}]},B=i=>i.size>300*1024?(I.error("\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 300kb!"),!1):!0,V=(i,a)=>{i.code===0?d.value.push(z(S({},i.body),{isHandle:!0})):i.code===8888&&o.push("/login")},v=(i,a)=>!i.id||i.isHandle?!0:de({id:i.id,actId:n.params.voteId,type:"voteInfo"}),F=i=>{d.value=d.value.filter(a=>a.id!=i.id)},E=async i=>{if(!await me(e)){I.error("\u8BF7\u68C0\u67E5\u5FC5\u586B\u9879\uFF0C\u5E26\u7EA2\u661F\u4E3A\u5FC5\u586B");return}if(!d.value.length){I.error("\u8BF7\u81F3\u5C11\u4E0A\u4F20\u4E00\u5F20banner\u56FE:");return}let a=z(S({},r.value),{bannerImgArr:d.value.map(f=>f.id),status:i});console.log("",a),n.params.voteId?await se(a):await re(a),I.success("\u64CD\u4F5C\u6210\u529F"),o.push({name:"voteList"})},A=async()=>{let k=(await ie({id:n.params.voteId})).data.body,{bannerArr:a,status:f,storeId:_,createTime:c,createUser:b,fileWebPath:g,prizeImgUrl:T,prizeUrl:R,ruleUrl:Me}=k,G=j(k,["bannerArr","status","storeId","createTime","createUser","fileWebPath","prizeImgUrl","prizeUrl","ruleUrl"]);r.value=S({},G),d.value=a&&a.map(M=>({id:M.id,url:M.fileWebPath}))||[]};return H(()=>{n.params.voteId&&A()}),{formData:r,formRules:s,actionUrl:m,header:D,imageUrls:d,ruleForm:e,handleSave:E,beforeAvatarUpload:B,handleAvatarSuccess:V,beforeRemove:v,onRemove:F}}}),ve={class:"justify-between"},ce=w("span",null,"\u53D1\u8D77\u8BC4\u9009",-1),_e=p("\u8FD4\u56DE"),Ce=p(" \u4E0A\u4F20\u56FE\u7247"),Be=w("i",{class:"el-icon-plus avatar-uploader-icon"},null,-1),Ae=p(" \u6BCF "),he=p("\u5206\u949F\u8D85\u8FC7 "),we=p("\u7968\uFF0C\u9501\u5B9A "),Te=p("\u5206\u949F "),Ue=p("\u4E0D\u9700\u8981"),Se=p("\u9700\u8981"),Ie=p("\u4E0D\u9700\u8981"),Re=p("\u9700\u8981"),ze=p("\u4E0D\u9700\u8981"),Oe=p("\u9700\u8981"),Ye=p("\u4E0D\u9700\u8981"),$e=p("\u9700\u8981"),He=p("\u4FDD\u5B58"),Pe=p("\u53D1\u8D77\u8BC4\u9009");function ke(e,u,o,n,D,d){const m=y("el-button"),r=y("el-input"),s=y("el-form-item"),B=y("el-upload"),V=y("CkEditor"),v=y("el-date-picker"),F=y("el-radio"),E=y("el-radio-group"),A=y("el-form"),i=y("el-card");return h(),P("div",null,[l(i,null,{header:t(()=>[w("div",ve,[ce,w("span",null,[l(m,{type:"success",size:"mini"},{default:t(()=>[_e]),_:1})])])]),default:t(()=>[l(A,{ref:"ruleForm",model:e.formData,"label-width":"160px",rules:e.formRules},{default:t(()=>[l(s,{label:"\u8BC4\u9009\u4E3B\u9898",prop:"title"},{default:t(()=>[l(r,{modelValue:e.formData.title,"onUpdate:modelValue":u[0]||(u[0]=a=>e.formData.title=a),size:"small",placeholder:"\u8BC4\u9009\u4E3B\u9898",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6EDA\u52A8\u6587\u5B57"},{default:t(()=>[l(r,{modelValue:e.formData.rollTitle,"onUpdate:modelValue":u[1]||(u[1]=a=>e.formData.rollTitle=a),size:"small",placeholder:"\u6EDA\u52A8\u6587\u5B57",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6BCF\u4EBA\u53EF\u6295\u7968\u603B\u6570:"},{default:t(()=>[l(r,{modelValue:e.formData.userVoteDayNum,"onUpdate:modelValue":u[2]||(u[2]=a=>e.formData.userVoteDayNum=a),type:"number",size:"small",placeholder:"\u6BCF\u4EBA\u53EF\u6295\u7968\u603B\u6570",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6BCF\u5929\u6BCF\u4EBA\u53EF\u6295\u7968\u6B21\u6570:"},{default:t(()=>[l(r,{modelValue:e.formData.userVoteSingleNum,"onUpdate:modelValue":u[3]||(u[3]=a=>e.formData.userVoteSingleNum=a),type:"number",size:"small",placeholder:"\u6BCF\u5929\u6BCF\u4EBA\u53EF\u6295\u7968\u6B21\u6570",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6BCF\u5929\u53EF\u6295\u7968\u603B\u6570:"},{default:t(()=>[l(r,{modelValue:e.formData.maxVoteNum,"onUpdate:modelValue":u[4]||(u[4]=a=>e.formData.maxVoteNum=a),type:"number",size:"small",placeholder:"\u6BCF\u5929\u53EF\u6295\u7968\u603B\u6570",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"\u8BBF\u95EE\u91CF:",type:"number"},{default:t(()=>[l(r,{modelValue:e.formData.initialNum,"onUpdate:modelValue":u[5]||(u[5]=a=>e.formData.initialNum=a),type:"number",size:"small",placeholder:"\u8BBF\u95EE\u91CF",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"\u4E0A\u4F20banner\u56FE:"},{default:t(()=>[l(B,{multiple:!1,class:"avatar-uploader",action:e.actionUrl,"on-success":e.handleAvatarSuccess,"before-remove":e.beforeRemove,"on-remove":e.onRemove,"before-upload":e.beforeAvatarUpload,headers:e.header,name:"uploadFile","file-list":e.imageUrls,"list-type":"picture"},{default:t(()=>[l(m,{type:"primary"},{default:t(()=>[Ce,Be]),_:1})]),_:1},8,["action","on-success","before-remove","on-remove","before-upload","headers","file-list"])]),_:1}),l(s,{label:"\u6D3B\u52A8\u89C4\u5219:"},{default:t(()=>[l(V,{modelValue:e.formData.ruleHtml,"onUpdate:modelValue":u[6]||(u[6]=a=>e.formData.ruleHtml=a),type:"Full"},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6D3B\u52A8\u5956\u54C1:"},{default:t(()=>[l(V,{modelValue:e.formData.prizeHtml,"onUpdate:modelValue":u[7]||(u[7]=a=>e.formData.prizeHtml=a),type:"Full"},null,8,["modelValue"])]),_:1}),l(s,{label:"\u5956\u54C1\u56FE\u7247:"},{default:t(()=>[l(V,{modelValue:e.formData.prizeImgHtml,"onUpdate:modelValue":u[8]||(u[8]=a=>e.formData.prizeImgHtml=a),type:"Full"},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4:",prop:"startTime"},{default:t(()=>[l(v,{modelValue:e.formData.startTime,"onUpdate:modelValue":u[9]||(u[9]=a=>e.formData.startTime=a),size:"small",type:"datetime",placeholder:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYYMMDDHHmmss"},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4:",prop:"endTime"},{default:t(()=>[l(v,{modelValue:e.formData.endTime,"onUpdate:modelValue":u[10]||(u[10]=a=>e.formData.endTime=a),size:"small",type:"datetime",placeholder:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYYMMDDHHmmss"},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6295\u7968\u5F00\u59CB\u65F6\u95F4:",prop:"startVoteTime"},{default:t(()=>[l(v,{modelValue:e.formData.startVoteTime,"onUpdate:modelValue":u[11]||(u[11]=a=>e.formData.startVoteTime=a),size:"small",type:"datetime",placeholder:"\u6295\u7968\u5F00\u59CB\u65F6\u95F4",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYYMMDDHHmmss"},null,8,["modelValue"])]),_:1}),l(s,{label:"\u6295\u7968\u7ED3\u675F\u65F6\u95F4:",prop:"endVoteTime"},{default:t(()=>[l(v,{modelValue:e.formData.endVoteTime,"onUpdate:modelValue":u[12]||(u[12]=a=>e.formData.endVoteTime=a),size:"small",type:"datetime",placeholder:"\u6295\u7968\u7ED3\u675F\u65F6\u95F4",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYYMMDDHHmmss"},null,8,["modelValue"])]),_:1}),l(s,{label:"\u81EA\u52A8\u9501\u5B9A:"},{default:t(()=>[Ae,l(r,{modelValue:e.formData.minuteVote,"onUpdate:modelValue":u[13]||(u[13]=a=>e.formData.minuteVote=a),type:"number",size:"small",style:{width:"150px"}},null,8,["modelValue"]),he,l(r,{modelValue:e.formData.maxMinuteVote,"onUpdate:modelValue":u[14]||(u[14]=a=>e.formData.maxMinuteVote=a),type:"number",size:"small",style:{width:"150px"}},null,8,["modelValue"]),we,l(r,{modelValue:e.formData.lockingMinute,"onUpdate:modelValue":u[15]||(u[15]=a=>e.formData.lockingMinute=a),type:"number",size:"small",style:{width:"150px"}},null,8,["modelValue"]),Te]),_:1}),l(s,{label:"\u662F\u5426\u533F\u540D\u9001\u7968:"},{default:t(()=>[l(E,{modelValue:e.formData.isAnonymou,"onUpdate:modelValue":u[16]||(u[16]=a=>e.formData.isAnonymou=a)},{default:t(()=>[l(F,{label:0},{default:t(()=>[Ue]),_:1}),l(F,{label:1},{default:t(()=>[Se]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"\u6DFB\u52A0\u9009\u624B\u662F\u5426\u9700\u8981\u5BA1\u6838:"},{default:t(()=>[l(E,{modelValue:e.formData.isExamine,"onUpdate:modelValue":u[17]||(u[17]=a=>e.formData.isExamine=a)},{default:t(()=>[l(F,{label:0},{default:t(()=>[Ie]),_:1}),l(F,{label:1},{default:t(()=>[Re]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"\u662F\u5426\u5F00\u542F\u94BB\u77F3\u6295\u7968:"},{default:t(()=>[l(E,{modelValue:e.formData.isPayOrder,"onUpdate:modelValue":u[18]||(u[18]=a=>e.formData.isPayOrder=a)},{default:t(()=>[l(F,{label:0},{default:t(()=>[ze]),_:1}),l(F,{label:1},{default:t(()=>[Oe]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"\u662F\u5426\u5F00\u542F\u968F\u673A\u6295\u7968 :"},{default:t(()=>[l(E,{modelValue:e.formData.isRandomVote,"onUpdate:modelValue":u[19]||(u[19]=a=>e.formData.isRandomVote=a)},{default:t(()=>[l(F,{label:0},{default:t(()=>[Ye]),_:1}),l(F,{label:1},{default:t(()=>[$e]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[l(r,{modelValue:e.formData.remark,"onUpdate:modelValue":u[20]||(u[20]=a=>e.formData.remark=a),type:"textarea",row:4,placeholder:"\u5907\u6CE8",style:{width:"50%"}},null,8,["modelValue"])]),_:1}),e.$route.name!="voteListShow"?(h(),W(s,{key:0},{default:t(()=>[l(m,{type:"primary",class:"mr-10",onClick:u[21]||(u[21]=()=>e.handleSave())},{default:t(()=>[He]),_:1}),l(m,{type:"primary",onClick:u[22]||(u[22]=()=>e.handleSave(2))},{default:t(()=>[Pe]),_:1})]),_:1})):J("",!0)]),_:1},8,["model","rules"])]),_:1})])}var Je=O(Ee,[["render",ke]]);export{Je as default};
