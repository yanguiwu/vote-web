var J=Object.defineProperty,K=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var Q=(e,i,r)=>i in e?J(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,k=(e,i)=>{for(var r in i||(i={}))U.call(i,r)&&Q(e,r,i[r]);if(E)for(var r of E(i))q.call(i,r)&&Q(e,r,i[r]);return e},j=(e,i)=>K(e,X(i));var R=(e,i)=>{var r={};for(var s in e)U.call(e,s)&&i.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&E)for(var s of E(e))i.indexOf(s)<0&&q.call(e,s)&&(r[s]=e[s]);return r};import{_ as Y,c as Z,a as x,D as ee,p as te,i as ae,b as ue}from"./index.b1bc12a8.js";import{q as ne}from"./index.5c36cd16.js";import{u as M,p as ie,a as oe,b as le}from"./player.417f7472.js";import{h as se,r as g,P as re,k as c,l as C,q as _,D as n,U as y,V as de,z as F,y as me,O as l,L as h,B as D,C as t}from"./element-plus.b05a9d59.js";import{Q as ce}from"./qrcode.vue.esm.9ecb8274.js";const pe=se({components:{QrcodeVue:ce},emits:["on-search"],setup(e,i){const r=Z(),s=x();let w=g({name:"",id:""}),S=g([]),o=g([]),v=g({}),p=g({current:1,size:20,recordCount:0});const I=u=>{const{getUserInfo:m,getUserListData:b}=ue();return`${m.sysSetting&&m.sysSetting.apiDomain||window.location.origin}/wx/#/pages/player/index?voteId=${u.id}&playerId=45`},z=u=>{u&&(w.value={name:"",id:""}),p.value={current:1,size:20,recordCount:0},f()},d=async u=>{if(!u.addInitialTicketNum){y.success("\u8BF7\u8F93\u5165\u9700\u8981\u589E\u52A0\u7684\u6D4F\u89C8\u91CF");return}await M({infoId:s.params.voteId,subIdArr:u.id,maxTicketNum:Number(u.addInitialTicketNum),minTicketNum:Number(u.addInitialTicketNum)}),y.success("\u64CD\u4F5C\u6210\u529F"),f()},T=u=>{r.push({name:"voteListPlayerListRecord",params:{voteId:s.params.voteId,playerId:u}})},N=()=>{r.push({name:"voteListPlayerCreate",params:{voteId:s.params.voteId}})},A=()=>{r.push({name:"voteListPlayerBetchCreate",params:{voteId:s.params.voteId}})},V=u=>{r.push({name:"voteListPlayerEdit",params:{voteId:s.params.voteId,playerId:u}})},L=async(u,m)=>{await ie({subId:u,todayStar:m?0:1,infoId:s.params.voteId}),y.success("\u64CD\u4F5C\u6210\u529F"),f()},B=async(u,m)=>{await le({id:u,status:m,infoId:s.params.voteId}),y.success("\u64CD\u4F5C\u6210\u529F"),f()},a=(u,m)=>{if(m===2){de.confirm("\u786E\u8BA4\u5220\u9664\u9009\u624B\uFF1F","\u63D0\u793A",{cancelButtonText:"\u53D6\u6D88",confirmButtonText:"\u786E\u8BA4"}).then(()=>{B(u,m)});return}B(u,m)},P=()=>{if(!o.value.length){y.warning("\u8BF7\u9009\u62E9\u9700\u8981\u64CD\u4F5C\u7684\u6570\u636E");return}a(o.value.map(u=>u.id).join(","),2)},f=async()=>{let $=(await oe(k(k({infoId:s.params.voteId},w.value),p.value))).data.body,{data:m}=$,b=R($,["data"]);S.value=m.map(W=>j(k({},W),{addInitialTicketNum:""})),p.value=k({},b)},G=u=>{p.value=j(k({},p.value),{current:u}),f()},H=u=>{o.value=u},O=async(u,m)=>{if(!o.value.length){y.warning("\u8BF7\u9009\u62E9\u9700\u8981\u64CD\u4F5C\u7684\u6570\u636E");return}await M({infoId:s.params.voteId,subIdArr:o.value.map(b=>b.id).join(","),maxTicketNum:m,minTicketNum:u}),y.success("\u64CD\u4F5C\u6210\u529F"),f()};return re(async()=>{f();let u=await ne({id:s.params.voteId});v.value=u.data.body}),{listData:S,formData:w,pageData:p,voteData:v,handleSearch:z,handleEdit:V,handleGoPlayer:T,handleCreateClick:N,DateStringConvert:ee,playerStatusStr:te,handleChangeStatus:a,handleStart:L,pCurrentChange:G,handleSelectionChange:H,handleBetchDelete:P,handleChangeTicket:O,handleBetchClick:A,infoStatusStr:ae,handleAddInitialTicketNum:d,getUrl:I}}}),Ce={class:"justify-between"},he={key:0},fe=l("\u5DF2\u5173\u95ED"),_e=l("\u672A\u5F00\u542F"),ye=l("\u6DFB\u52A0\u9009\u624B"),Fe=l("\u6279\u91CF\u6DFB\u52A0"),ke=l("\u641C\u7D22"),ve=l("\u5168\u90E8"),ge={class:"mb-2"},De=l("\u6279\u91CF\u5220\u9664"),we=l("\u4E00\u952E\u968F\u673A\u4FEE\u6539\u7968\u6570\uFF081-10\uFF09"),Be=l("\u4E00\u952E\u968F\u673A\u4FEE\u6539\u7968\u6570\uFF0810-30\uFF09"),be={class:"color-danger"},Ee=F("br",null,null,-1),Se=l("\u5141\u8BB8\u6295\u7968"),Ie=l("\u505C\u6B62\u6295\u7968"),ze=l("\u590D\u5236\u9009\u624B\u94FE\u63A5"),Te=l("\u6570\u636E\u8BB0\u5F55"),Ne=l("\u4FEE\u6539"),Ae=l("\u5220\u9664");function Ve(e,i,r,s,w,S){const o=c("el-button"),v=c("el-input"),p=c("el-form-item"),I=c("el-form"),z=c("el-divider"),d=c("el-table-column"),T=c("el-image"),N=c("el-tooltip"),A=c("QrcodeVue"),V=c("el-table"),L=c("el-pagination"),B=c("el-card");return C(),_(B,null,{header:n(()=>[F("div",Ce,[F("span",null,[e.voteData.status==1?(C(),me("span",he,[e.voteData.infoStatus==2?(C(),_(o,{key:0,size:"mini",type:"success"},{default:n(()=>[l(h(e.infoStatusStr(e.voteData.infoStatus)),1)]),_:1})):(C(),_(o,{key:1,size:"mini",type:"warning"},{default:n(()=>[l(h(e.infoStatusStr(e.voteData.infoStatus)),1)]),_:1}))])):D("",!0),e.voteData.status==3?(C(),_(o,{key:1,size:"mini",type:"warning"},{default:n(()=>[fe]),_:1})):D("",!0),e.voteData.status==0?(C(),_(o,{key:2,size:"mini",type:"warning"},{default:n(()=>[_e]),_:1})):D("",!0),l(" \u6D3B\u52A8\uFF1A"+h(e.voteData.title),1)]),F("span",null,[t(o,{type:"success",size:"mini",onClick:e.handleCreateClick},{default:n(()=>[ye]),_:1},8,["onClick"]),t(o,{type:"success",size:"mini",onClick:e.handleBetchClick},{default:n(()=>[Fe]),_:1},8,["onClick"])])])]),default:n(()=>[t(I,{inline:!0,model:e.formData,class:"demo-form-inline"},{default:n(()=>[t(p,null,{default:n(()=>[t(v,{modelValue:e.formData.name,"onUpdate:modelValue":i[0]||(i[0]=a=>e.formData.name=a),size:"mini",placeholder:"\u8F93\u5165\u9009\u624B\u540D\u79F0\u5173\u952E\u5B57",style:{width:"146px"},class:"mr-2"},null,8,["modelValue"]),t(o,{type:"primary",size:"mini",onClick:i[1]||(i[1]=()=>e.handleSearch())},{default:n(()=>[ke]),_:1}),t(o,{type:"primary",size:"mini",class:"mr-5",onClick:i[2]||(i[2]=()=>e.handleSearch(!0))},{default:n(()=>[ve]),_:1})]),_:1})]),_:1},8,["model"]),t(z,{class:"mt-1 mb-4"}),F("div",ge,[t(o,{type:"danger",size:"mini",onClick:e.handleBetchDelete},{default:n(()=>[De]),_:1},8,["onClick"]),t(o,{type:"danger",size:"mini",onClick:i[3]||(i[3]=a=>e.handleChangeTicket(1,10))},{default:n(()=>[we]),_:1}),t(o,{type:"danger",size:"mini",onClick:i[4]||(i[4]=a=>e.handleChangeTicket(10,30))},{default:n(()=>[Be]),_:1})]),t(V,{data:e.listData,border:"",onSelectionChange:e.handleSelectionChange},{default:n(()=>[t(d,{type:"selection",width:"55"}),t(d,{width:"60px",prop:"infoSeq",label:"\u9009\u624B\u7F16\u53F7"}),t(d,{prop:"name",label:"\u5E97\u94FA\u540D"},{default:n(a=>[t(T,{style:{width:"100%",height:"auto"},src:a.row.fileWebPath,fit:"fill"},null,8,["src"]),l(" "+h(a.row.name),1)]),_:1}),t(d,{prop:"phone",label:"\u624B\u673A\u53F7"}),t(d,{label:"\u7968\u6570","min-width":"120px"},{default:n(a=>[F("span",be,h(a.row.ticketNum),1),l(" / "+h(a.row.orderTicketNum+a.row.ticketNum+a.row.initialTicketNum)+" ",1),Ee,t(v,{modelValue:e.listData[a.$index].addInitialTicketNum,"onUpdate:modelValue":P=>e.listData[a.$index].addInitialTicketNum=P,style:{width:"60px"},type:"number",size:"mini"},null,8,["modelValue","onUpdate:modelValue"]),t(N,{class:"item",effect:"dark",content:"\u52A0\u7968\u8F93\u5165\u6B63\u6570\uFF0C\u51CF\u7968\u8F93\u5165\u8D1F\u6570",placement:"top"},{default:n(()=>[t(o,{icon:"el-icon-plus",size:"mini",onClick:()=>e.handleAddInitialTicketNum(a.row)},null,8,["onClick"])]),_:2},1024)]),_:1}),t(d,{prop:"invitationTime",label:"\u793C\u7269"}),t(d,{prop:"viewNum",label:"\u6D4F\u89C8\u6B21\u6570"}),t(d,{width:"90px",prop:"createTime",label:"\u53C2\u4E0E\u65F6\u95F4"},{default:n(a=>[l(h(e.DateStringConvert(a.row.createTime)),1)]),_:1}),t(d,{prop:"invitationName",label:"\u94FE\u63A5"},{default:n(a=>[t(A,{value:e.getUrl(a.row),size:"60",level:"H"},null,8,["value"])]),_:1}),t(d,{prop:"remark",label:"\u5907\u6CE8"}),t(d,{label:"\u72B6\u6001",width:"95px"},{default:n(a=>[a.row.status==1?(C(),_(o,{key:0,size:"mini",type:"info",onClick:()=>e.handleChangeStatus(a.row.id,3)},{default:n(()=>[Se]),_:2},1032,["onClick"])):D("",!0),a.row.status==3?(C(),_(o,{key:1,size:"mini",type:"danger",onClick:()=>e.handleChangeStatus(a.row.id,1)},{default:n(()=>[Ie]),_:2},1032,["onClick"])):D("",!0)]),_:1}),t(d,{label:"\u64CD\u4F5C",width:"230px"},{default:n(a=>[t(o,{size:"mini",type:"info",class:"mb-2"},{default:n(()=>[ze]),_:1}),t(o,{size:"mini",type:"info",class:"mb-2",onClick:()=>e.handleGoPlayer(a.row.id)},{default:n(()=>[Te]),_:2},1032,["onClick"]),F("div",null,[t(o,{size:"mini",type:a.row.todayStar?"danger":"info",onClick:()=>e.handleStart(a.row.id,a.row.todayStar)},{default:n(()=>[l(h(a.row.todayStar?"\u4ECA\u65E5\u4E4B\u661F":"\u8BBE\u4E3A\u4ECA\u65E5\u4E4B\u661F"),1)]),_:2},1032,["type","onClick"]),t(o,{size:"mini",type:"info",onClick:()=>e.handleEdit(a.row.id)},{default:n(()=>[Ne]),_:2},1032,["onClick"]),t(o,{size:"mini",type:"info",onClick:()=>e.handleChangeStatus(a.row.id,2)},{default:n(()=>[Ae]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data","onSelectionChange"]),t(L,{layout:"prev, pager, next",total:e.pageData.recordCount,"page-size":e.pageData.size,onCurrentChange:e.pCurrentChange},null,8,["total","page-size","onCurrentChange"])]),_:1})}var Qe=Y(pe,[["render",Ve]]);export{Qe as default};
